---
## Author
author:
  name: Чигладзе Майя Владиславовна
  degrees: student
  orcid: 0000-0002-0877-7063
  email: 1132239399@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 119530
      city: Москва
      address: ул. Очаковское шоссе, д. 9А

## Title
title: "Отчёт по лабораторной работе"
subtitle: "Администрирование сетевых подсистем"
license: "CC BY"
---

# Цель работы

Получить навыки настройки межсетевого экрана в Linux в части переадресации
портов и настройки Masquerading.

# Задание

1. Настройте межсетевой экран виртуальной машины server для доступа к серверу
по протоколу SSH не через 22-й порт, а через порт 2022 (см. разделы 7.4.1 и 7.4.2).
2. Настройте Port Forwarding на виртуальной машине server (см. разделы 7.4.3).
4. Настройте маскарадинг на виртуальной машине server для организации доступа
клиента к сети Интернет (см. раздел 7.4.3).
4. Напишите скрипт для Vagrant, фиксирующий действия по расширенной настройке
межсетевого экрана. Соответствующим образом внести изменения в Vagrantfile.

# Теоретическое введение

Некоторые часто используемые команды firewall-cmd:
– вывод на экран описания опций firewall-cmd:
firewall-cmd --help
– проверка активности firewalld:
firewall-cmd --state
– перезагрузка правил межсетевого экрана с сохранением информации о состоянии:
firewall-cmd --reload
– вывод на экран списка поддерживаемых зон/служб:
firewall-cmd --get-zones
firewall-cmd --get-services
– вывод на экран включённых в зоне служб:
firewall-cmd [ --zone=<zone> ] --list-services
– включение службы в пределах зоны:
firewall-cmd [--zone=<zone>] --add-service=<service>
– включение маскарадинга в пределах зоны:
firewall-cmd [--zone=<zone>] --add-masquerad
– включение переадресации или переназначения портов в пределах зоны:
firewall-cmd [--zone=<zone>]
--add-forward-port=port=<port>[-<port>]:proto=<protocol> {
:toport=<port>[-<port>] | :toaddr=<address> |
:toport=<port>[-<port>]:toaddr=<address> }– обработка зон с постоянными параметрами (опция --permanent должна быть первой
для всех постоянных вызовов):
firewall-cmd --permanent <опция>

# Выполнение лабораторной работы

1. Загрузите вашу операционную систему и перейдите в рабочий каталог с проектом:
cd /var/tmp/user_name/vagrant  
Здесь user_name — идентифицирующее вас имя пользователя, обычно первые буквы
инициалов и фамилия (см. рис. @fig-001).

![Загружаем операционную систему](image/1.jpg){#fig-001 width=70%}

2. Запустите виртуальную машину server:
make server-up  
(или, если вы работаете под ОС Windows, то `vagrant up server`) (см. рис. @fig-002).

![Запускаем ВМ](image/2.jpg){#fig-002 width=70%}

3. На виртуальной машине server войдите под вашим пользователем и откройте терминал.
Перейдите в режим суперпользователя (см. рис. @fig-003).

![Входим в суперпользователя](image/3.jpg){#fig-003 width=70%}

4. На основе существующего файла описания службы ssh создайте файл с собственным описанием (см. рис. @fig-004).

![Создаем файл](image/4.jpg){#fig-004 width=70%}

5. Посмотрите содержимое файла службы:
cat /etc/firewalld/services/ssh-custom.xml ([рис. @fig-005]).

![Смотрим содержимое файла службы](image/5.jpg){#fig-005 width=70%}

Объяснение:
1.  XML-формат: Все файлы служб firewalld должны быть валидными XML-документами.
2.  Корневой элемент <service>: Каждый файл должен содержать один корневой элемент <service>.
3.  Обязательные и необязательные элементы: <short> и <description> являются рекомендуемыми, но не строго обязательными для функциональности. <port> (или <source-port>, <protocol>, <icmp-block>, <icmp-type>, <module>, <destination>) - это функциональные элементы, которые определяют, какой трафик разрешен.
4.  Атрибуты: Многие элементы (например, <port>) используют атрибуты для более детального определения параметров (например, protocol, port).
5.  Именование файлов: Имя файла XML (без расширения .xml) становится именем службы, которое используется в firewall-cmd (например, ssh-custom.xml определяет службу с именем ssh-custom).

6. Откройте файл описания службы на редактирование и замените порт 22 на новый
порт (2022):
<port protocol="tcp" port="2022"/>
В этом же файле скорректируйте описание службы для демонстрации, укажите, что
это модифицированный файл службы ([рис. @fig-006]).

![Открываем файл на редактирование](image/6.jpg){#fig-006 width=70%}

7. Просмотрите список доступных FirewallD служб:
firewall-cmd --get-services
Обратите внимание, что новая служба ещё не отображается в списке ([рис. @fig-007]).

![Смотрим список доступных служб](image/7.jpg){#fig-007 width=70%}

8. Перегрузите правила межсетевого экрана с сохранением информации о состоянии
и вновь выведите на экран список служб, а также список активных служб ([рис. @fig-008]).

![Перезагружаем правила межсетевого экрана](image/8.jpg){#fig-008 width=70%}

9. Добавьте новую службу в FirewallD и выведите на экран список активных служб  ([рис. @fig-009]).

![Добавляем новую службу](image/9.jpg){#fig-009 width=70%}

10. Если служба успешно добавлена в FirewallD, то перегрузите правила межсетевого
экрана с сохранением информации о состоянии ([рис. @fig-010]).

![Перезагружаем правила экрана](image/10.jpg){#fig-010 width=70%}

## Перенаправление портов

1. Организуйте на сервере переадресацию с порта 2022 на порт 22 ([рис. @fig-021]).

![Организовываем на сервере переадресацию с порта на порт](image/2.1.jpg){#fig-021 width=70%}

2. На клиенте попробуйте получить доступ по SSH к серверу через порт 2022:
ssh -p 2022 user@server.user.net
(вместо user укажите свой логин)([рис. @fig-032]).

![Пробуем получить доступ к ссш](image/3.2.jpg){#fig-032 width=70%}

## Настройка Port Forwarding и Masquerading

1. На сервере посмотрите, активирована ли в ядре системы возможность перенаправ-
ления IPv4-пакетов пакетов ([рис. @fig-031]).

![Активирована ли возможность управления](image/3.1.jpg){#fig-031 width=70%}

2. Включите перенаправление IPv4-пакетов на сервере ([рис. @fig-0322]).

![Включаем перенаправление пакетов](image/3.2.2.jpg){#fig-0322 width=70%}

3. Включите маскарадинг на сервере ([рис. @fig-033]).

![Включаем маскарадинг на сервере](image/3.3.jpg){#fig-033 width=70%}

4. На клиенте проверьте доступность выхода в Интернет ([рис. @fig-034]).

![Проверяем доступность выхода в интернет](image/3.4.jpg){#fig-034 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

1. На виртуальной машине server перейдите в каталог для внесения изменений
в настройки внутреннего окружения /vagrant/provision/server/, создайте в нём
каталог firewall, в который поместите в соответствующие подкаталоги конфигура-
ционные файлы FirewallD ([рис. @fig-041]).

![Вносим изменения во внутреннее окружение](image/4.1.jpg){#fig-041 width=70%}

2. В каталоге /vagrant/provision/server создайте файл firewall.sh:
Открыв его на редактирование, пропишите в нём следующий скрипт ([рис. @fig-042]).

![Пишем скрипт](image/42.jpg){#fig-042 width=70%}

3. restorecon -vR /etc
Для отработки созданного скрипта во время загрузки виртуальной машины server
в конфигурационном файле Vagrantfile необходимо добавить в разделе конфигу-
рации для сервера ([рис. @fig-0422]).

![Изменяем вагрантфайл](image/4.2.2.jpg){#fig-0422 width=70%}

# Выводы

В ходе лабораторной работы я получила навыки настройки межсетевого экрана в Linux в части переадресации
портов и настройки Masquerading.

# Список литературы{.unnumbered}

1. NAT: вопросы и ответы. — URL: https://www.cisco.com/cisco/web/support/RU/9/
92/92029_nat-faq.html (дата обр. 13.09.2025).
2. Динамический брандмауэр с использованием FirewallD. — URL: https : / /
fedoraproject.org/wiki/FirewallD/ru (дата обр. 13.09.2025).
3. Одом У. Официальное руководство Cisco по подготовке к сертификационным эк-
заменам CCENT/CCNA ICND1 100-101. — М.: Вильямс, 2017. — 912 с. — (Cisco Press
Core Series).
4. Часто задаваемые вопросы по технологии NAT / Сайт поддержки продуктов и тех-
нологий компании Cisco. — URL: https://www.cisco.com/c/ru_ru/support/docs/ip/
network-address-translation-nat/26704-nat-faq-00.html (дата обр. 13.09.2025).

::: {#refs}
:::
