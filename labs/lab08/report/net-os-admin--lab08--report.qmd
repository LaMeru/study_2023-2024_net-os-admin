---
## Author
author:
  name: Чигладзе Майя Владиславовна
  degrees: student
  orcid: 0000-0002-0877-7063
  email: 1132239399@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 119530
      city: Москва
      address: ул. Очаковское шоссе, д. 9А

## Title
title: "Отчёт по лабораторной работе №8"
subtitle: "Администрирование сетевых подсистем"
license: "CC BY"
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию SMTP-сервера.

# Задание

1. Установите на виртуальной машине server SMTP-сервер postfix (см. раздел 8.4.1).
2. Сделайте первоначальную настройку postfix при помощи утилиты postconf, задав
отправку писем не на локальный хост, а на сервер в домене (см. раздел 8.4.2).
3. Проверьте отправку почты с сервера и клиента (см. раздел 8.4.3).
4. Сконфигурируйте Postfix для работы в домене. Проверьте отправку почты с сервера
и клиента (см. раздел 8.4.4).
5. Напишите скрипт для Vagrant, фиксирующий действия по установке и настройке
Postfix во внутреннем окружении виртуальной машины server. Соответствующим
образом внесите изменения в Vagrantfile (см. раздел 8.4.5).

# Теоретическое введение

Mail/Mailx – консольный почтовый клиент для Unix/Linux-подобных операционных
систем. Начиная с CentOS9/Rocky9, входит в пакет s-nail.
Синтаксис:
mail [OPTION...] [address...]
Список некоторых опций mail:
-r from адрес: задать адрес отправителя;
-s тема: задать тему сообщения;
-e: проверить наличие почты в почтовом ящике;
-w: отправить письмо без ожидания завершения пересылки;
-q: завершить работу команды mail после получения прерывания.
Полное описание опций mail см. в соответствующем man руководстве.
При чтении почты утилита mailx находится в командном режиме. На экран вы-
водятся заголовки первых нескольких сообщений, а затем выводится приглашение,
означающее готовность к вводу стандартных команд. Для обработки и просмотра
почты доступны следующие команды:
n: перейти к следующему письму;
d: удалить письмо;
dq: удалить письмо и выйти из mail;
h n: показать заголовок письма с номером n.

# Выполнение лабораторной работы

## Postfix

На виртуальной машине server войдите под вашим пользователем и откройте тер-
минал (см. рис. @fig-011).

![Входим в суперпользователя](image/1.1.jpg){#fig-011 width=70%}

Установите необходимые для работы пакеты (см. рис. @fig-012).

![Установим необходимые пакеты](image/1.2.png){#fig-012 width=70%}

Сконфигурируйте межсетевой экран, разрешив работать службе протокола SMTP (см. рис. @fig-013).

![Конфигурировала экран](image/1.3.png){#fig-013 width=70%}

Восстановите контекст безопасности в SELinux (см. рис. @fig-014).

![Восстановила контекст безопасности](image/1.4.png){#fig-014 width=70%}

Запустите Postfix ([рис. @fig-015]).

![Запустила Постфикс](image/1.5.png){#fig-015 width=70%}

## Изменение параметров Postfix с помощью postconf

Для просмотра списка текущих настроек Postfix введите ([рис. @fig-021]).

![Просматриваю список текущих настроек](image/2.1.png){#fig-021 width=70%}

Посмотрите текущее значение параметра myorigin (см. рис. @fig-022).

![Текущее значение](image/2.2.png){#fig-022 width=70%}

Посмотрите текущее значение параметра mydomain (см. рис. @fig-023).

![Текущее значение домейн](image/2.3.png){#fig-023 width=70%}

Замените значение параметра myorigin на значение параметра mydomain (см. рис. @fig-024).

![Замена значения параметра](image/2.4.png){#fig-024 width=70%}

Повторите команду ([рис. @fig-025]).

![Повтор команды](image/2.5.png){#fig-025 width=70%}

Проверьте корректность содержания конфигурационного файла main.cf ([рис. @fig-026]).

![Проверяю корректность содержания](image/2.6.png){#fig-026 width=70%}

Перезагрузите (перечитайте) конфигурационные файлы Postfix ([рис. @fig-027]).

![Перезагрузила файл](image/2.7.png){#fig-027 width=70%}

Просмотрите все параметры с значением, отличным от значения по умолчанию ([рис. @fig-028]).

![Просмотрела параметры со значением](image/2.8.png){#fig-028 width=70%}

Задайте жёстко значение домена (вместо user укажите свой логин) ([рис. @fig-029]).

![Задала значение домена](image/2.9.png){#fig-029 width=70%}

Отключите IPv6 в списке разрешённых в работе Postfix протоколов и оставьте только IPv4 ([рис. @fig-210]).

![Отключили АйпиВ6 в списке разрешенных проктолоков](image/2.10.png){#fig-210 width=70%}

Перезагрузите конфигурацию Postfix ([рис. @fig-211]).

![Перезагрузила конфигурацию](image/2.11.png){#fig-211 width=70%}

## Проверка работы Postfix

На сервере под учётной записью пользователя отправьте себе письмо, используя утилиту mail ([рис. @fig-031]).

![Отправила себе письмо](image/3.1.png){#fig-031 width=70%}

На втором терминале запустите мониторинг работы почтовой службы и посмотрите, что произошло с вашим сообщением ([рис. @fig-032]).

![Запустила мониторинг работы](image/3.2.png){#fig-032 width=70%}

На виртуальной машине client войдите под вашим пользователем и откройте терминал. Перейдите в режим суперпользователя ([рис. @fig-033]).

![Суперпользователь клиента](image/3.3.png){#fig-033 width=70%}

На клиенте установите необходимые для работы пакеты ([рис. @fig-034]).

![Установила пакеты](image/3.4.png){#fig-034 width=70%}

Отключите IPv6 в списке разрешённых в работе Postfix протоколов и оставьте только IPv4 ([рис. @fig-035]).

![Отключила в списке протоколов](image/3.5.png){#fig-035 width=70%}

На клиенте запустите Postfix ([рис. @fig-036]).

![Запустила постфикс](image/3.6.png){#fig-036 width=70%}

На клиенте под учётной записью пользователя аналогичным образом отправьте себе второе письмо, используя утилиту mail. Сравните результат мониторинга почтовой службы на сервере при отправке сообщения с сервера и с клиента. В отчёте отразите, доставлено сообщение или нет ([рис. @fig-037]).
Сообщение доставлено 
Отправитель: root@mvchigladze.net (системный пользователь root с сервера)
Получатель: mvchigladze@server.mvchigladze.net
Статус доставки: status=sent (delivered to mailbox)

![Отправила письмо](image/3.7.png){#fig-037 width=70%}

На сервере в конфигурации Postfix посмотрите значения параметров сетевых интерфейсов inet_interfaces и сетевых адресов mynetworks ([рис. @fig-038]).

![Посмотрела значение параметров](image/3.8.png){#fig-038 width=70%}

Разрешите Postfix прослушивать соединения не только с локального узла, но и с других интерфейсов сети ([рис. @fig-039]).

![Разрешила прослушивание соединения](image/3.9.png){#fig-039 width=70%}

Добавьте адрес внутренней сети, разрешив таким образом пересылку сообщений между узлами сети ([рис. @fig-310]).

![Добавила адрес сети](image/3.10.png){#fig-310 width=70%}

Перезагрузите конфигурацию Postfix и перезапустите Postfix ([рис. @fig-311]).

![Перезагрузила конфигурацию Постфикс](image/3.11.png){#fig-311 width=70%}

Повторите отправку сообщения с клиента. В отчёте отразите, что произошло с вашим сообщением. ([рис. @fig-312]).

![Повторила отправку сообщения](image/3.12.png){#fig-312 width=70%}

## Конфигурация Postfix для домена

Запустите мониторинг работы почтовой службы и посмотрите, что произошло с вашим сообщением ([рис. @fig-042]).

![Запустила мониторинг работы](image/4.2.png){#fig-042 width=70%}

Дополнительно посмотрите, какие сообщения ожидают в очереди на отправление ([рис. @fig-043]).

![Какие сообщения ожидают в очереди](image/4.3.png){#fig-043 width=70%}

Для настройки возможности отправки сообщений не на конкретный узел сети, а на доменный адрес пропишите MX-запись с указанием имени почтового сервера mail.user.net (вместо user укажите свой логин) в файле прямой DNS-зоны ([рис. @fig-044]).

![Настройка возможности отправки](image/4.4.png){#fig-044 width=70%}

В конфигурации Postfix добавьте домен в список элементов сети, для которых дан-
ный сервер является конечной точкой доставки почт ([рис. @fig-045]).

![Добавила домен в список](image/4.5.png){#fig-045 width=70%}

Перезагрузите конфигурацию Postfix ([рис. @fig-046]).

![Перезагрузила конфигурацию](image/4.6.png){#fig-046 width=70%}

Восстановите контекст безопасности в SELinux ([рис. @fig-047]).

![Восстановила контекст безопасности](image/4.7.png){#fig-047 width=70%}

Перезапустите DNS ([рис. @fig-048]).

![Перезапустила ДНС](image/4.8.png){#fig-048 width=70%}

Попробуйте отправить сообщения, находящиеся в очереди на отправление ([рис. @fig-049]).

![Проубю отправить сообщение в очереди](image/4.9.png){#fig-049 width=70%}

Проверьте отправку почты с клиента на доменный адрес ([рис. @fig-410]).

![Проверила отправку почты](image/4.10.png){#fig-410 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перейдите в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/server/ ([рис. @fig-051]).

![Перешла в каталог внутреннего окружения](image/5.1.png){#fig-051 width=70%}

В каталоге /vagrant/provision/server создайте исполняемый файл mail.sh ([рис. @fig-053]).

![Создала исполняемый файл](image/5.3.png){#fig-053 width=70%}

На виртуальной машине client перейдите в каталог для внесения изменений в настройки внутреннего окружения /vagrant/provision/client/ ([рис. @fig-054]).

![Перешла в каталог клиент](image/5.4.png){#fig-054 width=70%}

В каталоге /vagrant/provision/client создайте исполняемый файл mail.sh ([рис. @fig-055]).

![Создала исполняемый файл и отредактировала](image/5.5.png){#fig-055 width=70%}

Для отработки созданного скрипта во время загрузки виртуальной машины server в конфигурационном файле Vagrantfile необходимо добавить в разделе конфигурации для сервера([рис. @fig-056]).

![Редактировала ВагрантФайл](image/5.6.png){#fig-056 width=70%}

Для отработки созданного скрипта во время загрузки виртуальной машины client в конфигурационном файле Vagrantfile необходимо добавить в разделе конфигурации для клиента([рис. @fig-057]).

![Редактировала ВагрантФайл](image/5.7.png){#fig-057 width=70%}

# Выводы

В ходе лабораторной работы, я приобрела практических навыков по установке и конфигурированию SMTP-сервера.

# Список литературы{.unnumbered}

Postfix Documentation. — URL: http://www.postfix.org/documentation.html (visited
on 09/13/2021).

::: {#refs}
:::
