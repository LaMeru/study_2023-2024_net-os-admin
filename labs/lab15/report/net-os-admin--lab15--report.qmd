---
## Author
author:
  name: Чигладзе Майя Владиславовна
  degrees: student
  orcid: 0000-0002-0877-7063
  email: 1132239399@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 119530
      city: Москва
      address: ул. Очаковское шоссе, д. 9А

## Title
title: "Отчёт по лабораторной работе №15"
subtitle: "Администрирование сетевых подсистем"
license: "CC BY"
---

# Цель работы

Получение навыков по работе с журналами системных событий.

# Задание

1. Настройте сервер сетевого журналирования событий.
2. Настройте клиент для передачи системных сообщений в сетевой журнал на сервере.
3. Просмотрите журналы системных событий с помощью нескольких программ. При наличии сообщений о некорректной работе сервисов исправьте
ошибки в настройках соответствующих служб.
4. Напишите скрипты для Vagrant, фиксирующие действия по установке и настройке
сетевого сервера журналирования.

# Теоретическое введение

В системах на базе Unix/Linux важное место при администрировании занимает от-
слеживание системных событий (и в частности возникновение возможных ошибок
в процессе настройки каких-то служб) через ведение log-файлов процессов системы.
Журналирование системных событий заключается в фиксировании с помощью со-
кета syslog в лог-файлах сообщений об ошибках и сообщений о состоянии работы
практически всех процессов системы. Обычно лог-файлы располагаются в каталоге
/var/log.
Для управления логированием событий обычно используется служба syslog или
её модификация rsyslog. С их помощью можно настроить уровень подробности
логирования для каждого процесса. Все настройки rsyslog находятся в файле
/etc/rsyslog.conf. В этот же файл подключаются дополнительные файлы настройки
из каталога /etc/rsyslog.d/.

# Выполнение лабораторной работы

## Настройка сервера сетевого журнала

1. На сервере создайте файл конфигурации сетевого хранения журналов:
cd /etc/rsyslog.d
touch netlog-server.conf (см. рис. @fig-011).

![Создаем файл](image/1.1.jpg){#fig-011 width=70%}

2. В файле конфигурации /etc/rsyslog.d/netlog-server.conf включите приём запи-
сей журнала по TCP-порту 514:
$ModLoad imtcp
$InputTCPServerRun 514 (см. рис. @fig-012).

![В файле конфигурации вклчаем прием записей](image/1.2.jpg){#fig-012 width=70%}

3. Перезапустите службу rsyslog и посмотрите, какие порты, связанные с rsyslog,
прослушиваются:
systemctl restart rsyslog
lsof | grep TCP (см. рис. @fig-013).

![Перезапустила службу](image/1.3.jpg){#fig-013 width=70%}

4. На сервере настройте межсетевой экран для приёма сообщений по TCP-порту 514:
firewall-cmd --add-port=514/tcp
firewall-cmd --add-port=514/tcp --permanent (см. рис. @fig-014).

![Настроила экран](image/1.4.jpg){#fig-014 width=70%}

## Настройка клиента сетевого журнала

1. На клиенте создайте файл конфигурации сетевого хранения журналов:
cd /etc/rsyslog.d
touch netlog-client.conf ([рис. @fig-021]).

![Создала файл конфигурации](image/2.1.jpg){#fig-021 width=70%}

2. На клиенте в файле конфигурации /etc/rsyslog.d/netlog-client.conf включите
перенаправление сообщений журнала на 514 TCP-порт сервера (вместо user укажи-
те свой логин):
*.* @@server.user.net:514 (см. рис. @fig-022).

![Перенаправила сообщения](image/2.2.jpg){#fig-022 width=70%}

3. Перезапустите службу rsyslog:
systemctl restart rsyslog (см. рис. @fig-023).

![Перезапустила службу](image/2.3.jpg){#fig-023 width=70%}

## Просмотр журнала

1. На сервере просмотрите один из файлов журнала
tail -f /var/log/messages
Обратите внимание на имя хоста и другие сообщения о работе сервисов. При нали-
чии сообщений о некорректной работе сервисов исправьте ошибки в настройках
соответствующих служб. ([рис. @fig-031]).

![Просмотрела файлы журнала](image/3.1.jpg){#fig-031 width=70%}

2. На сервере под пользователем user (вместо user укажите свой логин) запустите
графическую программу для просмотра журналов:
gnome-system-monitor ([рис. @fig-032]).

![Запустила графическую программу](image/3.2.jpg){#fig-032 width=70%}

3. На сервере установите просмотрщик журналов системных сообщений lnav или его
аналог:
dnf -y install lnav ([рис. @fig-033]).

![Установила просмотрщик журналов](image/3.3.jpg){#fig-033 width=70%}

4. Просмотрите логи с помощью lnav или его аналога:
lnav
Просмотрите записи с сервера и клиента. ([рис. @fig-034]).

![Просмотрела логи](image/3.4.jpg){#fig-034 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

1. На виртуальной машине server перейдите в каталог для внесения изменений
в настройки внутреннего окружения /vagrant/provision/server/, создайте в нём
каталог netlog, в который поместите в соответствующие подкаталоги конфигура-
ционные файлы ([рис. @fig-041]).

![Перешла в каталог](image/4.1.jpg){#fig-041 width=70%}

2. В каталоге /vagrant/provision/server создайте исполняемый файл netlog.sh ([рис. @fig-042]).

![Создаем файл](image/4.2.jpg){#fig-042 width=70%}

3. На виртуальной машине client перейдите в каталог для внесения изменений
в настройки внутреннего окружения /vagrant/provision/client/, создайте в нём
каталог nentlog, в который поместите в соответствующие подкаталоги конфигура-
ционные файлы ([рис. @fig-043]).

![Перешла в каталог](image/4.3.jpg){#fig-043 width=70%}

4. В каталоге /vagrant/provision/client создайте исполняемый файл netlog.sh:
cd /vagrant/provision/client
touch netlog.sh
chmod +x netlog.sh ([рис. @fig-044]).

![Создала исполняемый файл](image/4.4.jpg){#fig-044 width=70%}

5. Для отработки созданных скриптов во время загрузки виртуальных машин server
и client в конфигурационном файле Vagrantfile необходимо добавить в соответ-
ствующих разделах конфигураций для сервера и клиента:
server.vm.provision "server netlog",
type: "shell",
preserve_order: true,
path: "provision/server/netlog.sh"
client.vm.provision "client netlog",
type: "shell",
preserve_order: true,
path: "provision/client/netlog.sh"  ([рис. @fig-045]).

![Изменила вагрантфайл](image/4.5.jpg){#fig-045 width=70%}

# Выводы

В ходе выполнения лабораторной работы я получила навыки по работе с журналами системных событий.

# Список литературы{.unnumbered}

::: {#refs}
:::
